<div class="container">
  <h1 class="mb-4">Mi Perfil</h1>

  <!-- Informaci√≥n b√°sica del usuario -->
  <table class="table table-bordered">
    <tr>
      <th>Usuario:</th>
      <td><%= user.username %></td>
    </tr>
    <tr>
      <th>Email:</th>
      <td><%= user.email %></td>
    </tr>
    <tr>
      <th>Roles:</th>
      <td>
        <% if (user.roles && user.roles.length) { %>
          <%= user.roles.map(role => role.name).join(', ') %>
        <% } else { %>
          Sin roles
        <% } %>
      </td>
    </tr>
    <tr>
      <th>Fecha de Creaci√≥n:</th>
      <td><%= new Date(user.createdAt).toLocaleDateString('es-ES') %></td>
    </tr>
  </table>

  <hr>

  <!-- Posts que el usuario ha dado like -->
  <h2 class="mt-4">Art√≠culos que te gustaron ‚ù§Ô∏è</h2>

  <% if (likedPosts.length > 0) { %>
    <div class="row">
      <% likedPosts.forEach(post => { %>
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title">
                <a href="/post/<%= post._id %>"><%= post.title %></a>
              </h5>
              <p class="card-text">
                Categor√≠a: <%= post.category ? post.category.name : 'Sin categor√≠a' %><br>
                Autor: <%= post.author ? post.author.username : 'An√≥nimo' %>
              </p>
              <a href="/post/<%= post._id %>" class="btn btn-primary btn-sm">Ver art√≠culo</a>
            </div>
          </div>
        </div>
      <% }); %>
    </div>
  <% } else { %>
    <p>No has dado like a ning√∫n art√≠culo todav√≠a.</p>
  <% } %>

  <hr>

  <!-- Posts que el usuario ha guardado como favorito -->
  <h2 class="mt-4">Tus Favoritos ‚≠ê</h2>

  <% if (favoritedPosts.length > 0) { %>
    <div class="row">
      <% favoritedPosts.forEach(post => { %>
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title">
                <a href="/post/<%= post._id %>"><%= post.title %></a>
              </h5>
              <p class="card-text">
                Categor√≠a: <%= post.category ? post.category.name : 'Sin categor√≠a' %><br>
                Autor: <%= post.author ? post.author.username : 'An√≥nimo' %>
              </p>
              <a href="/post/<%= post._id %>" class="btn btn-primary btn-sm">Ver art√≠culo</a>
            </div>
          </div>
        </div>
      <% }); %>
    </div>
  <% } else { %>
    <p>No has guardado ning√∫n art√≠culo como favorito.</p>
  <% } %>

  <hr>

  <!-- Comentarios que el usuario ha dejado -->
  <h2 class="mt-4">Tus Comentarios üìù</h2>

  <% if (userComments.length > 0) { %>
    <ul class="list-group">
      <% userComments.forEach(comment => { %>
        <li class="list-group-item">
          <strong>En el post:</strong>
          <% if (comment.postId) { %>
            <a href="/post/<%= comment.postId._id %>"><%= comment.postId.title %></a>
          <% } else { %>
            <em>Post eliminado</em>
          <% } %>
          <br>
          <strong>Fecha:</strong> <%= new Date(comment.createdAt).toLocaleDateString('es-ES') %>
          <p class="mb-1"><%= comment.body %></p>
        </li>
      <% }); %>
    </ul>
  <% } else { %>
    <p>No has dejado ning√∫n comentario todav√≠a.</p>
  <% } %>

  <hr>

  <!-- Respuestas que el usuario ha dejado -->
  <h2 class="mt-4">Tus Respuestas üí¨</h2>

  <% if (userReplies.length > 0) { %>
    <ul class="list-group">
      <% userReplies.forEach(reply => { %>
        <li class="list-group-item">
          <strong>En el post:</strong>
          <% if (reply.postId) { %>
            <a href="/post/<%= reply.postId._id %>"><%= reply.postId.title %></a>
          <% } else { %>
            <em>Post eliminado</em>
          <% } %>
          <br>
          <strong>A la respuesta:</strong>
          <% if (reply.parentId) { %>
            "<%= reply.parentId.body.length > 50 ? reply.parentId.body.slice(0, 50) + '...' : reply.parentId.body %>"
          <% } else { %>
            <em>Comentario eliminado</em>
          <% } %>
          <br>
          <strong>Fecha:</strong> <%= new Date(reply.createdAt).toLocaleDateString('es-ES') %>
          <p class="mb-1"><%= reply.body %></p>
        </li>
      <% }); %>
    </ul>
  <% } else { %>
    <p>No has respondido a ning√∫n comentario todav√≠a.</p>
  <% } %>

  <hr>

  <!-- Enlace de cerrar sesi√≥n -->
  <div class="text-center">
    <a href="/profile/logout" class="btn btn-danger mt-4">Cerrar Sesi√≥n</a>
  </div>
</div>
